# Design: Features 1.1-1.3 - Tagowanie, Ścieżka Rozumowania, Wizualizacje

**Data:** 2025-12-06
**Status:** Approved
**Podejście:** Top-Down (Od UI do danych)
**Technologie:** Recharts (wykresy), React Flow (opcjonalnie dla knowledge graph)

---

## 1. Przegląd

Implementacja trzech krytycznych features z analizy braków:

- **1.1** Tagowanie jednostek informacji (information units)
- **1.2** Szczegółowa ścieżka rozumowania z linkami do źródeł
- **1.3** Wizualizacja danych liczbowych i wykresów

### Obecny stan backendu

- `StreamEvent.docs` zawiera tylko: `{title, source, relevance}`
- Dokumenty hardcoded jako demo w `nodes.py`
- Brak ekstrakcji faktów, tagowania, pełnych metadanych

### Obecny stan frontendu

- `ChainOfThought.tsx` pokazuje dokumenty minimalnie
- `ReportPanel.tsx` renderuje czysty markdown
- Brak komponentów dla tagów, grafów, wykresów

---

## 2. Nowe Struktury Danych

### 2.1 Backend (Pydantic)

#### InformationUnit (NOWE)
```python
class InformationUnit(BaseModel):
    """Jednostka informacji - otagowany fakt."""
    id: str
    content: str  # "Cena ropy Brent: $85/baryłka"
    fact_type: str  # "economic_indicator", "political_event"
    source_doc_ids: List[str]
    confidence: float = 0.8
    priority: int = 1  # 1=high, 2=medium, 3=low
    impacts: List[str] = []  # IDs wniosków
    entities: List[str] = []  # ["Russia", "OPEC"]
```

#### DocumentMetadata (rozszerzone)
```python
class DocumentMetadata(BaseModel):
    # Nowe pola:
    title: str = ""
    snippet: Optional[str] = None  # Fragment z highlighted terms
    author: Optional[str] = None
    published_date: Optional[str] = None
    document_type: Optional[str] = None
    relevance_score: float = 0.0
    related_tags: List[str] = []
```

#### ChartData (NOWE)
```python
class ChartData(BaseModel):
    """Dane do wykresów."""
    chart_type: str  # "line", "bar", "pie", "area"
    title: str
    data: List[Dict[str, Any]]
    x_axis_label: Optional[str] = None
    y_axis_label: Optional[str] = None
    unit: Optional[str] = None  # "$bn", "%"
```

### 2.2 Frontend (TypeScript)

Odpowiednie interfejsy TypeScript w `src/types/schemas.ts`.

---

## 3. Plan Implementacji

### Faza 1: Backend - Schematy (1-2h)
1. Rozszerzyć `schemas/schemas.py`
2. Dodać helper functions w `agents/nodes.py`

### Faza 2: Backend - Agenci (3-4h)
3. Modyfikować `region_node()` - ekstrakcja faktów, pełne docs
4. Modyfikować `synthesis_node()` - ekstrakcja wykresów

### Faza 3: Frontend - Schematy (1h)
5. Rozszerzyć `frontend/src/types/schemas.ts`

### Faza 4: Frontend - Komponenty (4-5h)
6. `TaggedInfoPanel.tsx` - panel z tagami
7. `ReasoningPathViewer.tsx` - ścieżka rozumowania
8. `DataVisualization.tsx` - wykresy (Recharts)

### Faza 5: Integracja (2-3h)
9. Połączyć komponenty w głównym UI
10. Rozszerzyć `useAnalysis` hook
11. Testing end-to-end

**Szacowany czas:** 13-18 godzin

---

## 4. Kluczowe Komponenty

### TaggedInfoPanel
- Lista otagowanych faktów z filtrami (priorytet, typ)
- Kliknięcie → modal z detalami i powiązanymi dokumentami

### ReasoningPathViewer
- Lista kroków rozumowania (expandable)
- Każdy krok pokazuje pełne dokumenty źródłowe
- Modal dokumentu z snippet, metadanymi, linkiem

### DataVisualization
- Renderowanie wykresów z Recharts
- Typy: line, bar, pie, area
- Responsywne, z tooltips i legendami

---

## 5. Metryki Sukcesu

**1.1 Tagowanie:**
- Backend ekstrahuje min. 5 faktów/dokument
- Frontend pokazuje panel z filtrami
- Kliknięcie w tag → powiązane dokumenty

**1.2 Ścieżka rozumowania:**
- Pełne metadane dokumentów (url, snippet, date)
- Highlighted query terms w snippet
- Modal z wszystkimi szczegółami

**1.3 Wykresy:**
- Min. 2 wykresy z raportu
- Line/bar/pie charts działają
- Responsywne i czytelne

---

*Koniec design document*
